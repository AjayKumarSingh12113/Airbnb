<% layout('/layouts/boilerplate') %>

<style>
  #filters {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    justify-content: center;
  }

  .filter {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    text-decoration: none;
    color: inherit;
  }

  .filter:hover {
    background: #007bff;
    color: white;
    transform: translateY(-4px);
  }

  .filter i {
    font-size: 20px;
    margin-bottom: 5px;
  }

  .filter p {
    margin: 0;
    font-size: 14px;
    font-weight: 500;
  }
</style>

<body>
  <!-- ðŸ”¹ Category Filters -->
  <div id="filters">
    <a href="/listings/category/trending" class="filter">
      <div><i class="fa-solid fa-fire"></i></div>
      <p>Trending</p>
    </a>
    <a href="/listings/category/rooms" class="filter">
      <div><i class="fa-solid fa-bed"></i></div>
      <p>Rooms</p>
    </a>
    <a href="/listings/category/farms" class="filter">
      <div><i class="fa-solid fa-tractor"></i></div>
      <p>Farms</p>
    </a>
    <a href="/listings/category/cities" class="filter">
      <div><i class="fa-solid fa-city"></i></div>
      <p>Iconic Cities</p>
    </a>
    <a href="/listings/category/beach" class="filter">
      <div><i class="fa-solid fa-umbrella-beach"></i></div>
      <p>Beach</p>
    </a>
    <a href="/listings/category/cabins" class="filter">
      <div><i class="fa-solid fa-house"></i></div>
      <p>Cabins</p>
    </a>
    <a href="/listings/category/pools" class="filter">
      <div><i class="fa-solid fa-person-swimming"></i></div>
      <p>Pools</p>
    </a>
    <a href="/listings/category/mountain" class="filter">
      <div><i class="fa-solid fa-volcano"></i></div>
      <p>Mountain</p>
    </a>
    <a href="/listings/category/castles" class="filter">
      <div><i class="fa-solid fa-chess"></i></div>
      <p>Castles</p>
    </a>
    <a href="/listings/category/arctic" class="filter">
      <div><i class="fa-solid fa-snowflake"></i></div>
      <p>Arctic</p>
    </a>
    <div class="m-3 border border-primary  rounded p-2">
      <div class="form-check-reverse form-switch  ">
      <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
      <label class="form-check-label" for="flexSwitchCheckDefault">Display Taxes</label>
      </div>
    </div>
  </div>

  <!-- ðŸ”¹ Listings Section -->
<% 
  // Filter listings based on activeCategory
  let filteredListings = activeCategory ? allListing.filter(listing => listing.category === activeCategory) : allListing;
%>

<h2 style="text-align:center; margin-bottom:20px;">
  <%= activeCategory ? activeCategory.charAt(0).toUpperCase() + activeCategory.slice(1) : 'All' %> Listings
</h2>

<% if(filteredListings.length === 0) { %>
  <h1 style="text-align:center; margin-top:50px;">
    This <%= activeCategory.charAt(0).toUpperCase() + activeCategory.slice(1) %> has no listing
  </h1>
<% } else { %>
  <div class="listing-grid">
    <% filteredListings.forEach(listing => { %>
      <div class="listing-card">
        <a href="/listings/<%= listing._id %>">
          <img src="<%= listing.image.url %>" alt="<%= listing.title %>">
          <div class="listing-info">
            <h2><%= listing.title %></h2>
            <p class="location"><%= listing.location %>, <%= listing.country %></p>
            <p class="price">â‚¹<%= listing.price %> / night
              <i class="tax-info">&nbsp;+ 18% GST</i>
            </p>
          </div>
        </a>
      </div>
    <% }) %>
  </div>
<% } %>




  <!-- ðŸ”¹ Listings Section
   <% if(activeCategory === null){ %>
    <h2 style="text-align:center; margin-bottom:20px;">All Listings</h2>
  <div class="listing-grid">
    <% for (let listing of allListing) { %>
      <div class="listing-card">
        <a href="/listings/<%= listing._id %>">
          <img src="<%= listing.image.url %>" alt="<%= listing.title %>">
          <div class="listing-info">
            <h2><%= listing.title %></h2>
            <p class="location"><%= listing.location %>, <%= listing.country %></p>
            <p class="price">â‚¹<%= listing.price %> / night</p>
          </div>
        </a>
      </div>
    <% } %>
  </div>
  <% } else { %>
    <h2 style="text-align:center; margin-bottom:20px;"><%= activeCategory.charAt(0).toUpperCase() + activeCategory.slice(1) %> Listings</h2>
    <div class="listing-grid">
      <% for (let listing of allListing) { %>
        <% if (listing.category === activeCategory) { %>
          <div class="listing-card">
            <a href="/listings/<%= listing._id %>">
              <img src="<%= listing.image.url %>" alt="<%= listing.title %>">
              <div class="listing-info">
                <h2><%= listing.title %></h2>
                <p class="location"><%= listing.location %>, <%= listing.country %></p>
                <p class="price">â‚¹<%= listing.price %> / night</p>
              </div>
            </a>
          </div>
        <% } else{ %>
          <h1>
            This <%= activeCategory.charAt(0).toUpperCase() + activeCategory.slice(1) %> has no listing
          </h1>
        <% } %>
      <% } %>
    </div>
  <% } %> -->



  <!-- <h2 style="text-align:center; margin-bottom:20px;">
  <%= activeCategory ? activeCategory.charAt(0).toUpperCase() + activeCategory.slice(1) : 'All' %> Listings
</h2>

<div class="listing-grid">
  <% for (let listing of allListing) { %>
    <% if (!activeCategory || listing.category === activeCategory) { %>
      <div class="listing-card">
        <a href="/listings/<%= listing._id %>">
          <img src="<%= listing.image.url %>" alt="<%= listing.title %>">
          <div class="listing-info">
            <h2><%= listing.title %></h2>
            <p class="location"><%= listing.location %>, <%= listing.country %></p>
            <p class="price">â‚¹<%= listing.price %> / night</p>
          </div>
        </a>
      </div>
    <% } %>
  <% } %>
</div> -->

</body>

<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f6f9;
    margin: 0;
    padding: 30px;
  }

  .listing-grid {
    width: 100%;
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 25px;
  }

  @media (max-width: 1200px) {
    .listing-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  @media (max-width: 992px) {
    .listing-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .listing-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 480px) {
    .listing-grid {
      grid-template-columns: 1fr;
    }
  }

  .listing-card {
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease-in-out;
  }

  .listing-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
  }

  .listing-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }

  .listing-info {
    padding: 15px;
  }

  .listing-info h2 {
    font-size: 17px;
    color: #222;
    margin-bottom: 6px;
  }

  .listing-info .location {
    color: #555;
    font-size: 13px;
    margin-bottom: 8px;
  }

  .listing-info .price {
    font-weight: bold;
    color: #007bff;
    font-size: 15px;
  }

  .listing-card a {
    text-decoration: none;
    color: inherit;
  }

  .tax-info{
    display: none;
  }
</style>

<script>
  let taxSwitch = document.getElementById('flexSwitchCheckDefault');
  taxSwitch.addEventListener('click', function() {
    let taxInfo = document.getElementsByClassName('tax-info');
    for(info of taxInfo){
      if(info.style.display != 'inline'){
        info.style.display = 'inline';
        
      } else{
        info.style.display = 'none';
      }
    }
    
  });
</script>
